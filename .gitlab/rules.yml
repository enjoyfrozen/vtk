# Rules for where jobs can run
.ci_rules:
    rules:
      # rules for merge requests:
          # automatic jobs run at once
        - if: '$CI_MERGE_REQUEST_ID && $IS_AUTOMATIC == "true"'
          when: on_success
          # manual and scheduled jobs wait for user action
        - if: '$CI_MERGE_REQUEST_ID && ($IS_MANUAL == "true" || $IS_SCHEDULED == "true")'
          when: manual
          # merge request should not add the following jobs
        - if: '$CI_MERGE_REQUEST_ID && ($IS_MERGED_ONLY == "true" || $IS_WEEKLY_UPLOAD == "true" || $IS_TAG == "true")'
          when: never
      # branches with a tag
        - if: '$CI_COMMIT_TAG && $CI_PROJECT_PATH == "vtk/vtk" && ($IS_SCHEDULED == "true" || $IS_RELEASE == "true" || $IS_WEEKLY_UPLOAD == "true" || $IS_TAG == "true")'
          when: on_success
       # rules for jobs triggered from this project
        - if: '$CI_PROJECT_PATH == "vtk/vtk" && ($RUN_AUTOMATICALLY == "true" || $IS_MERGED_ONLY == "true")'
          when: on_success
        - if: '$CI_PROJECT_PATH == "vtk/vtk" && $IS_MANUAL == "true"'
          when: delayed
          start_in: 30 minutes
       # jobs triggered by scheduled a run
        - if: '$CI_PIPELINE_SOURCE == "schedule" && $CI_PROJECT_PATH == "vtk/vtk" && ($IS_MANUAL == "true" || $IS_SCHEDULED == "true")'
          when: on_success
        - if: '$RSYNC_UPLOAD_ENABLE == "true"'
          when: on_success
        - if: '$PYPI_WEEKLY_UPLOAD == "true"'
          when: on_success
        - when: never
